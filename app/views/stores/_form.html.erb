<%# app/views/stores/_form.html.erb %>

<%= form_with model: store, class: "space-y-6" do |f| %>
  <% if store.errors.any? %>
    <div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
      <h3 class="font-bold mb-2"><%= pluralize(store.errors.count, "件のエラー") %>があります</h3>
      <ul class="list-disc list-inside text-sm">
        <% store.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- 店舗基本情報 -->
  <div class="bg-white rounded-xl shadow p-6">
    <h2 class="text-lg font-bold mb-4">店舗情報</h2>

    <div class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">店舗コード <span class="text-red-500">*</span></label>
          <%= f.text_field :code, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "001" %>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">店舗名 <span class="text-red-500">*</span></label>
          <%= f.text_field :name, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "博多駅前店" %>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">住所</label>
        <%= f.text_field :address, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "福岡県福岡市博多区..." %>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">最寄駅</label>
        <%= f.text_field :nearest_station, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "博多駅" %>
      </div>
    </div>
  </div>

  <!-- 必要人数設定 -->
  <div class="bg-white rounded-xl shadow p-6">
    <h2 class="text-lg font-bold mb-4">必要人数設定</h2>
    <p class="text-sm text-gray-600 mb-4">曜日タイプ別に、薬剤師・事務それぞれの必要人数を設定してください。</p>

    <div class="space-y-4">
      <% sorted_requirements = store.store_requirements.sort_by { |r| StoreRequirement.day_types[r.day_type] || 0 } %>
      <% sorted_requirements.each do |requirement| %>
        <%= f.fields_for :store_requirements, requirement do |req| %>
          <div class="border rounded-lg p-4 bg-gray-50">
            <%= req.hidden_field :id %>
            <%= req.hidden_field :day_type %>

            <div class="flex items-center justify-between mb-3">
              <h3 class="font-bold text-gray-700">
                <% case req.object.day_type %>
                <% when "weekday" %>
                  📅 平日
                <% when "saturday" %>
                  📆 土曜
                <% when "holiday" %>
                  🎌 日祝
                <% end %>
              </h3>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">💊 薬剤師</label>
                <%= req.number_field :pharmacist_count, min: 0, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "0" %>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">📋 事務</label>
                <%= req.number_field :clerk_count, min: 0, class: "block w-full px-4 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500", placeholder: "0" %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- 送信ボタン -->
  <div class="flex gap-4">
    <%= f.submit store.persisted? ? '更新する' : '登録する', class: "flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition cursor-pointer" %>
    <%= link_to 'キャンセル', stores_path, class: "flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold text-center hover:bg-gray-300 transition" %>
  </div>
<% end %>
